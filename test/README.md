# 端到端测试文档

本目录包含了所有API接口的端到端测试文件，覆盖了项目中的所有主要功能模块。

## 测试文件列表

- `auth.e2e-spec.ts` - 认证模块测试（注册、登录、个人资料、刷新令牌）
- `articles.e2e-spec.ts` - 文章模块测试（公开和管理员文章API）
- `categories.e2e-spec.ts` - 分类模块测试（公开和管理员分类API）
- `comments.e2e-spec.ts` - 评论模块测试（公开和管理员评论API）
- `moments.e2e-spec.ts` - 动态模块测试（公开和管理员动态API）
- `works.e2e-spec.ts` - 作品模块测试（公开和管理员作品API）
- `users.e2e-spec.ts` - 用户模块测试（管理员用户管理和用户个人资料API）

## 运行测试

### 运行单个测试文件

```bash
# 运行认证模块测试
npm run test:e2e -- auth.e2e-spec.ts

# 运行文章模块测试
npm run test:e2e -- articles.e2e-spec.ts

# 运行其他模块测试...
```

### 运行所有测试

```bash
# 使用提供的脚本运行所有测试
./test/run-all-tests.sh

# 或者运行所有e2e测试
npm run test:e2e
```

## 测试覆盖范围

每个测试文件都包含以下测试场景：

### 1. 认证测试
- ✅ 用户注册
- ✅ 用户登录
- ✅ 获取用户资料
- ✅ 刷新访问令牌
- ✅ 无效输入验证
- ✅ 认证失败处理

### 2. 文章模块测试
- ✅ 公开文章列表（分页、推荐、热门）
- ✅ 文章标签获取
- ✅ 文章详情查看
- ✅ 文章浏览量统计
- ✅ 文章点赞功能
- ✅ 管理员文章CRUD操作
- ✅ 文章统计信息

### 3. 分类模块测试
- ✅ 公开分类列表
- ✅ 管理员分类CRUD操作
- ✅ 权限验证
- ✅ 输入验证

### 4. 评论模块测试
- ✅ 文章评论获取
- ✅ 评论创建
- ✅ 评论点赞
- ✅ 管理员评论管理（审核、拒绝、删除）
- ✅ 权限验证

### 5. 动态模块测试
- ✅ 公开动态列表（分页）
- ✅ 动态详情查看
- ✅ 动态浏览和点赞
- ✅ 管理员动态CRUD操作
- ✅ 权限验证

### 6. 作品模块测试
- ✅ 公开作品列表（分页、特色、分类筛选）
- ✅ 技术标签获取
- ✅ 作品详情查看
- ✅ 作品浏览和点赞
- ✅ 管理员作品CRUD操作
- ✅ 权限验证

### 7. 用户模块测试
- ✅ 管理员用户管理（列表、详情、更新、删除）
- ✅ 用户封禁/解封
- ✅ 用户统计信息
- ✅ 用户个人资料管理
- ✅ 密码修改
- ✅ 公开用户资料查看
- ✅ 用户访问统计

## 测试数据

测试使用动态生成的测试数据，包括：
- 随机用户名和邮箱（基于时间戳）
- 测试文章、评论、动态、作品数据
- 模拟的管理员账户

## 注意事项

1. **数据库清理**：每个测试文件都是独立的，会创建自己的测试数据
2. **认证令牌**：测试会自动处理用户注册和登录获取认证令牌
3. **权限测试**：包含了完整的权限验证测试
4. **错误处理**：测试覆盖了各种错误场景和边界情况
5. **API响应格式**：验证了API响应的数据结构和格式

## 环境要求

- Node.js 环境
- 数据库连接（测试数据库）
- 所有依赖包已安装

## 故障排除

如果测试失败，请检查：
1. 数据库连接是否正常
2. 环境变量是否正确配置
3. 服务器是否正常启动
4. 依赖包是否完整安装

运行测试前建议先启动开发服务器：
```bash
npm run start:dev
```